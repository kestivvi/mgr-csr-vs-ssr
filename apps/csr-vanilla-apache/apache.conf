# Global Apache configuration
ServerTokens Prod
ServerSignature Off

# Enable extended status for detailed metrics (must be global)
ExtendedStatus On

# Enable required modules
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule status_module modules/mod_status.so

# Custom log format similar to nginx
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" rt=%D" custom

# Main application server on port 80
<VirtualHost *:80>
    ServerName localhost
    DocumentRoot /usr/local/apache2/htdocs
    DirectoryIndex index.html

    CustomLog /var/log/apache2/access.log custom
    ErrorLog /var/log/apache2/error.log

    # Enable SPA routing - fallback to index.html for client-side routing
    <Directory "/usr/local/apache2/htdocs">
        Options -Indexes
        AllowOverride None
        Require all granted
        
        # Handle SPA routing
        FallbackResource /index.html
    </Directory>
</VirtualHost>

# Status monitoring server on port 8060
<VirtualHost *:8060>
    ServerName 127.0.0.1
    
    <Location /server-status>
        SetHandler server-status
        Require local
        Require ip 127.0.0.1
    </Location>
    
    # Log access to status endpoint
    CustomLog /var/log/apache2/status.log combined
    ErrorLog /var/log/apache2/status_error.log
</VirtualHost>
